CREATE database lab2223omada1_project_v3;

CREATE TABLE COMPANY(
COMPANY_NAME VARCHAR(25) NOT NULL,
HQ_ADDRESS VARCHAR(35),
INCOME_OUTCOME INT,
NUMBER_OF_SALESMEN INT,
NUMBER_OF_FACTORIES INT,
NEW_DRUG_RATE INT,
PRIMARY KEY(COMPANY_NAME)
);


CREATE TABLE DISTRIBUTOR(
DISTRIBUTOR_NAME VARCHAR(25) NOT NULL,
DISTR_POINTS INT,
DISTR_CAPACITY INT,
MEAN_DISTR_TIME INT,
DISTR_RANGE INT,
PRIMARY KEY(DISTRIBUTOR_NAME)
);


CREATE TABLE SALESMAN(
SALESMAN_NAME VARCHAR(25),
SALESMAN_SSN INT NOT NULL,
COMPANY_NAME VARCHAR(25),
DRUG_SERIAL_CODE BIGINT NOT NULL,
EXPERIENCE INT,
SALARY INT,
PRIMARY KEY(SALESMAN_SSN),
FOREIGN KEY(COMPANY_NAME) REFERENCES COMPANY(COMPANY_NAME),
FOREIGN KEY (SERIAL_CODE) REFERENCES DRUG(SERIAL_CODE)
);



CREATE TABLE DRUG(
SERIAL_CODE BIGINT NOT NULL,
COMPANY_NAME VARCHAR(25) NOT NULL,
DRUG_NAME VARCHAR(60),
TYPE VARCHAR(25),
APPROVAL BOOLEAN,
PRICE DECIMAL(8,2),
PRIMARY KEY(SERIAL_CODE,COMPANY_NAME),
FOREIGN KEY(COMPANY_NAME) REFERENCES COMPANY(COMPANY_NAME)
);


CREATE TABLE PATIENT(
PATIENT_SSN INT NOT NULL,
PATIENT_NAME VARCHAR(35),
AGE INT,
GENDER BOOLEAN,
PHONE_NUMBER INT,
PRIMARY KEY (PATIENT_SSN)
);


CREATE TABLE DOCTOR(
DOCTOR_SSN INT NOT NULL,
DOCTOR_NAME VARCHAR(35),
AGE INT,
EXPERIENCE_YEARS INT,
SPECIALTY VARCHAR(25),
PRIMARY KEY (DOCTOR_SSN)
);


CREATE TABLE SDOP(
CITY VARCHAR(25) NOT NULL,
SDOP_RANGE INT,
SDOP_CAPACITY INT,
ADDRESS VARCHAR(40),
SDOP_DELIVERY_TIME INT,
PRIMARY KEY (CITY)
);


CREATE TABLE PRESCRIPTION(
COMPANY_NAME VARCHAR(25) NOT NULL,
SERIAL_CODE BIGINT NOT NULL,
PATIENT_SSN INT NOT NULL,
DISEASE_CODE CHAR(3),
DATE_OF_PRESCRIPTION DATE,
PRIMARY KEY (SERIAL_CODE, COMPANY_NAME, PATIENT_SSN),
FOREIGN KEY (SERIAL_CODE) REFERENCES DRUG (SERIAL_CODE),
FOREIGN KEY (COMPANY_NAME) REFERENCES COMPANY (COMPANY_NAME),
FOREIGN KEY (PATEIENT_SSN) REFERENCES PATIENT (PETIENT_SSN)
);


CREATE TABLE PRODUCE(
COMPANY_NAME VARCHAR(25) NOT NULL,
SERIAL_CODE BIGINT NOT NULL,
PRIMARY KEY (COMPANY_NAME,SERIAL_CODE),
FOREIGN KEY (COMPANY_NAME) REFERENCES COMPANY (COMPANY_NAME),
FOREIGN KEY (SERIAL_CODE) REFERENCES DRUG (SERIAL_CODE)
);


CREATE TABLE BUY(
COMPANY_NAME VARCHAR(25) NOT NULL,
DISTRIBUTOR_NAME VARCHAR(25) NOT NULL,
PRIMARY KEY (COMPANY_NAME, DISTRIBUTOR_NAME),
FOREIGN KEY (COMPANY_NAME) REFERENCES COMPANY (COMPANY_NAME),
FOREIGN KEY (DISTRIBUTOR_NAME) REFERENCES DISTRIBUTOR (DISTRIBUTOR_NAME)
);


CREATE TABLE DISTRIBUTE(
DISTRIBUTOR_NAME VARCHAR(25) NOT NULL,
COMPANY_NAME VARCHAR(25) NOT NULL,
SERIAL_CODE BIGINT NOT NULL,
DAYS_UNTIL_DELIVERY INT,
PRIMARY KEY (DISTRIBUTOR_NAME, COMPANY_NAME, SERIAL_CODE),
FOREIGN KEY (DISTRIBUTOR_NAME) REFERENCES DISTRIBUTOR (DISTRIBUTOR_NAME),
FOREIGN KEY (COMPANY_NAME) REFERENCES COMPANY (COMPANY_NAME),
FOREIGN KEY (SERIAL_CODE) REFERENCES DRUG (SERIAL_CODE)
);


CREATE TABLE VISIT(
SALESMAN_SSN INT,
DOCTOR_SSN INT,
PRIMARY KEY (SALESMAN_SSN, DOCTOR_SSN),
FOREIGN KEY (SALESMAN_SSN) REFERENCES SALESMAN (SALESMAN_SSN),
FOREIGN KEY (DOCTOR_SSN) REFERENCES DOCTOR (DOCTOR_SSN)
);


CREATE TABLE PROVIDES(
CITY VARCHAR(25) NOT NULL,
ADDRESS VARCHAR(40) NOT NULL,
COMPANY_NAME VARCHAR(25) NOT NULL,
SERIAL_CODE BIGINT(20) NOT NULL,
PRIMARY KEY (CITY, ADDRESS, COMPANY_NAME, SERIAL_CODE),
FOREIGN KEY (CITY) REFERENCES SDOP (CITY),
FOREIGN KEY (ADDRESS) REFERENCES SDOP (ADDRESS),
FOREIGN KEY (COMPANY_NAME) REFERENCES DRUG (COMPANY_NAME),
FOREIGN KEY (SERIAL_CODE) REFERENCES DRUG (SERIAL_CODE)
);


CREATE TABLE SELL(
CITY VARCHAR(25) NOT NULL,
ADDRESS VARCHAR(40) NOT NULL,
DISTRIBUTOR_NAME VARCHAR(40) NOT NULL,
PRIMARY KEY (CITY, ADDRESS, DISTRIBUTOR_NAME),
FOREIGN KEY (CITY) REFERENCES SDOP (CITY),
FOREIGN KEY (ADDRESS) REFERENCES SDOP (ADDRESS),
FOREIGN KEY (DISTRIBUTOR_NAME) REFERENCES DISTRIBUTOR (DISTRIBUTOR_NAME)
);



CREATE TABLE HISTORY(
PATIENT_SSN INT NOT NULL,
COMPANY_NAME VARCHAR(25) NOT NULL,
SERIAL_CODE BIGINT NOT NULL,
MONTHS_PER_DOSE INT,
PRIMARY KEY (PATIENT_SSN, COMPANY_NAME, SERIAL_CODE),
FOREIGN KEY (PATIENT_SSN) REFERENCES PATIENT (PATIENT_SSN),
FOREIGN KEY (SERIAL_CODE) REFERENCES DRUG (SERIAL_CODE),
FOREIGN KEY (COMPANY_NAME) REFERENCES COMPANY (COMPANY_NAME)
);


CREATE TABLE PRESCRIBE(
COMPANY_NAME VARCHAR(25) NOT NULL,
SERIAL_CODE BIGINT NOT NULL,
DOCTOR_SSN INT NOT NULL,
PATIENT_SSN INT NOT NULL,
DOCTOR_NAME VARCHAR(35),
DATE_OF_PRESCRIPTION DATE,
PRIMARY KEY (COMPANY_NAME,SERIAL_CODE,DOCTOR_SSN),
FOREIGN KEY (DOCTOR_SSN) REFERENCES DOCTOR (DOCTOR_SSN),
FOREIGN KEY (COMPANY_NAME) REFERENCES COMPANY (COMPANY_NAME),
FOREIGN KEY (SERIAL_CODE) REFERENCES DRUG (SERIAL_CODE)
);


CREATE TABLE GOTO(
DOCTOR_SSN INT,
PATIENT_SSN INT,
PRIMARY KEY (PATIENT_SSN, DOCTOR_SSN),
FOREIGN KEY (PATIENT_SSN) REFERENCES PATIENT (PATIENT_SSN),
FOREIGN KEY (DOCTOR_SSN) REFERENCES DOCTOR (DOCTOR_SSN)
);